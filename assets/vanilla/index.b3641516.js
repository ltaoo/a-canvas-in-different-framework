var ue=Object.defineProperty;var fe=(D,w,B)=>w in D?ue(D,w,{enumerable:!0,configurable:!0,writable:!0,value:B}):D[w]=B;var p=(D,w,B)=>(fe(D,typeof w!="symbol"?w+"":w,B),B);(function(){"use strict";var D=document.createElement("style");D.textContent=`body{margin:0}.page{display:flex;width:100vw;height:100vh}.page__content{display:flex;flex-direction:column;flex:1}.page__extra{position:relative;display:flex;flex-direction:column;width:360px;border-left:1px solid #eee;background-color:#fff}.logo--vanilla{width:24px;height:24px;margin-right:12px}.settings{height:100%}.tools{position:relative;border-bottom:1px solid #eee;background-color:#fff;display:flex;align-items:center;justify-content:space-between;height:64px;padding:0 10px;font-size:13px;user-select:none}.canvas{position:relative;flex:1;width:100%;height:100%;user-select:none;overflow:hidden;background-color:#f9f9f9}.canvas__image{width:100%;height:100%;user-select:none;pointer-events:none}.canvas__range-selection{position:absolute;z-index:999;border:1px solid blue;background-color:#0ff;opacity:.4}.btns{display:flex;align-items:center}.btn{z-index:1;position:relative;margin-right:8px;color:#080808;cursor:pointer}.btn:last-child{margin-right:0}.btn--icon{padding:8px;border-radius:4px}.btn--icon:hover{background-color:#ececec}.btn--disabled{color:#999;cursor:not-allowed}.btn__icon{font-size:24px}.btn__input{z-index:0;position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;cursor:pointer}.history{color:#999}.history--active{color:#080809}.history__card{display:flex;align-items:center;padding:12px 0}.history__icon{margin-right:8px;font-size:24px}.layer{padding:12px 24px;margin-bottom:8px;cursor:pointer}.layer:last-child{margin-bottom:0}.layer--active{background-color:#999}.flex{display:flex;align-items:center;justify-content:space-between}.flex .left{justify-content:flex-start}.rect{position:absolute;border:1px solid transparent}.rect.bordered{border:1px solid #eb5648}.rect .square{position:absolute;width:7px;height:7px;background:white;border:1px solid #eb5648;border-radius:1px}.rect .resizable-handler{position:absolute;cursor:pointer;z-index:102}.rect .resizable-handler.tl{left:-8px;top:-8px}.rect .resizable-handler.tr{right:-8px;top:-8px}.rect .resizable-handler.bl{left:-8px;bottom:-8px}.rect .resizable-handler.br{right:-8px;bottom:-8px}.rect .resizable-handler.n{top:-8px;left:50%;transform:translate(-50%)}.rect .resizable-handler.s{bottom:-8px;left:50%;transform:translate(-50%)}.rect .resizable-handler.e{right:-8px;top:50%;transform:translateY(-50%)}.rect .resizable-handler.w{left:-8px;top:50%;transform:translateY(-50%)}.rect .rotate{position:absolute;left:50%;top:-32px;display:flex;justify-content:center;align-items:center;width:18px;height:18px;cursor:pointer;transform:translate(-50%)}
`,document.head.appendChild(D);var w=(i=>(i[i.Text=0]="Text",i[i.Image=1]="Image",i[i.Group=2]="Group",i))(w||{}),B=(i=>(i[i.Front=0]="Front",i[i.Back=1]="Back",i))(B||{}),S=(i=>(i[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",i))(S||{}),z=(i=>(i[i.Top=0]="Top",i[i.Left=1]="Left",i[i.Right=2]="Right",i[i.Bottom=3]="Bottom",i[i.HorizontalCenter=4]="HorizontalCenter",i[i.VerticalCenter=5]="VerticalCenter",i))(z||{}),M=(i=>(i[i.Top=0]="Top",i[i.Left=1]="Left",i[i.Bottom=2]="Bottom",i[i.Right=3]="Right",i[i.LeftTop=4]="LeftTop",i[i.LeftBottom=5]="LeftBottom",i[i.RightTop=6]="RightTop",i[i.RightBottom=7]="RightBottom",i))(M||{});function It({x:i,y:r},{x:t,y:e}){const n=i*t+r*e,s=i*e-r*t;return(Math.atan2(s,n)/Math.PI*180+360)%360}function W(i){return i*Math.PI/180}function T(i){return Math.cos(W(i))}function I(i){return Math.sin(W(i))}function V(i,r,t){const e=i+r;return e>t?i=e:(r=t-i,i=t),{width:i,deltaW:r}}function $(i,r,t){const e=i+r;return e>t?i=e:(r=t-i,i=t),{height:i,deltaH:r}}function Rt(i,r,t,e,n,s=1,o=1){let{width:a,height:c,centerX:l,centerY:d,angle:h}=r;const f=a<0?-1:1,g=c<0?-1:1;switch(a=Math.abs(a),c=Math.abs(c),i){case"e":{const u=V(a,t,s);a=u.width,t=u.deltaW,n&&typeof n=="number"?(e=t/n,c=a/n,l+=t/2*T(h)-e/2*I(h),d+=t/2*I(h)+e/2*T(h)):(l+=t/2*T(h),d+=t/2*I(h));break}case"tr":{e=-e;const u=V(a,t,s);a=u.width,t=u.deltaW;const m=$(c,e,o);c=m.height,e=m.deltaH,n&&typeof n=="number"&&(t=e*n,a=c*n),l+=t/2*T(h)+e/2*I(h),d+=t/2*I(h)-e/2*T(h);break}case"br":{const u=V(a,t,s);a=u.width,t=u.deltaW;const m=$(c,e,o);c=m.height,e=m.deltaH,n&&typeof n=="number"&&(t=e*n,a=c*n),l+=t/2*T(h)-e/2*I(h),d+=t/2*I(h)+e/2*T(h);break}case"s":{const u=$(c,e,o);c=u.height,e=u.deltaH,n&&typeof n=="number"?(t=e*n,a=c*n,l+=t/2*T(h)-e/2*I(h),d+=t/2*I(h)+e/2*T(h)):(l-=e/2*I(h),d+=e/2*T(h));break}case"bl":{t=-t;const u=V(a,t,s);a=u.width,t=u.deltaW;const m=$(c,e,o);c=m.height,e=m.deltaH,n&&typeof n=="number"&&(c=a/n,e=t/n),l-=t/2*T(h)+e/2*I(h),d-=t/2*I(h)-e/2*T(h);break}case"w":{t=-t;const u=V(a,t,s);a=u.width,t=u.deltaW,n&&typeof n=="number"?(c=a/n,e=t/n,l-=t/2*T(h)+e/2*I(h),d-=t/2*I(h)-e/2*T(h)):(l-=t/2*T(h),d-=t/2*I(h));break}case"tl":{t=-t,e=-e;const u=V(a,t,s);a=u.width,t=u.deltaW;const m=$(c,e,o);c=m.height,e=m.deltaH,n&&typeof n=="number"&&(a=c*n,t=e*n),l-=t/2*T(h)-e/2*I(h),d-=t/2*I(h)+e/2*T(h);break}case"n":{e=-e;const u=$(c,e,o);c=u.height,e=u.deltaH,n&&typeof n=="number"?(a=c*n,t=e*n,l+=t/2*T(h)+e/2*I(h),d+=t/2*I(h)-e/2*T(h)):(l+=e/2*I(h),d-=e/2*T(h));break}}return{position:{centerX:l,centerY:d},size:{width:a*f,height:c*g}}}const Ct=["n","ne","e","se","s","sw","w","nw"],kt={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Et={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7};function At(i,r){const t=kt[Math.floor(i/30)],n=(Et[r]+t)%8;return Ct[n]}function ht(i){return{width:i.length,height:i.height}}B.Front+"",B.Back+"";function Lt(i,r){const t=[];for(let e=0;e<r.length;e+=1){const n=r[e];zt(n.rect.client,i)&&t.push(n)}return t}function zt(i,r){const{left:t,top:e,width:n,height:s}=i,o=t+n,a=e+s,{left:c,top:l,width:d,height:h}=r,f=c+d,g=l+h;return Math.max(t,c)<=Math.min(o,f)&&Math.max(e,l)<=Math.min(a,g)}function Pt(i){const{left:r,right:t,bottom:e,top:n,center:s,width:o,height:a}=i;return[{type:S.Horizontal,origin:r,y:n,length:o,typeAtRect:z.Top},{type:S.Horizontal,origin:r,y:s.y,length:o,typeAtRect:z.HorizontalCenter},{type:S.Horizontal,y:e,origin:r,length:o,typeAtRect:z.Bottom},{type:S.Vertical,origin:n,x:r,length:a,typeAtRect:z.Left},{type:S.Vertical,origin:n,x:s.x,length:a,typeAtRect:z.VerticalCenter},{type:S.Vertical,origin:n,x:t,length:a,typeAtRect:z.Right}]}function Ot(i,r,t={}){const e=Pt(i),n=[],s={...i};for(let o=0;o<e.length;o+=1){const a=e[o];for(let c=0;c<r.length;c+=1){const l=r[c];if(Bt(a,l,t)){n.push(l);const d=a.typeAtRect;d===z.Top&&l.type===S.Horizontal&&(s.top=l.y),d===z.HorizontalCenter&&l.type===S.Horizontal&&(s.top=l.y-s.height/2),d===z.Bottom&&l.type===S.Horizontal&&(s.top=l.y-s.height),d===z.Left&&l.type===S.Vertical&&(s.left=l.x),d===z.VerticalCenter&&l.type===S.Vertical&&(s.left=l.x-s.width/2),d===z.Right&&l.type===S.Vertical&&(s.left=l.x-s.width)}}}return[s,n]}function Bt(i,r,t={}){const{type:e}=i,{type:n}=r,{threshold:s=10}=t;if(e!==n)return!1;if(e===S.Horizontal&&n===S.Horizontal){const o=i.y,a=r.y;return Math.abs(o-a)<s}if(e===S.Vertical&&n===S.Vertical){const o=i.x,a=r.x;return Math.abs(o-a)<s}return!1}function N(i={}){return Object.assign({left:0,top:0,bottom:0,right:0,width:0,height:0,angle:0,center:{x:0,y:0},index:0},i)}function dt(){let i=-1;return function(){return i+=1,i}}function Mt(i){return{all:i=i||new Map,on:function(r,t){var e=i.get(r);e?e.push(t):i.set(r,[t])},off:function(r,t){var e=i.get(r);e&&(t?e.splice(e.indexOf(t)>>>0,1):i.set(r,[]))},emit:function(r,t){var e=i.get(r);e&&e.slice().map(function(n){n(t)}),(e=i.get("*"))&&e.slice().map(function(n){n(r,t)})}}}class X{constructor(r){p(this,"values");p(this,"emitter");p(this,"listeners",[]);p(this,"errorListeners",[]);this.values=r,this.emitter=Mt()}addListener(r){this.listeners.includes(r)||this.listeners.push(r)}addErrorListener(r){this.errorListeners.includes(r)||this.errorListeners.push(r)}emitValuesChange(){if(this.values!==void 0)for(let r=0;r<this.listeners.length;r+=1){const t=this.listeners[r];t({...this.values})}}emitError(r){for(let t=0;t<this.errorListeners.length;t+=1){const e=this.errorListeners[t];e(r)}}get[Symbol.toStringTag](){return"Domain"}}const Dt=dt();class _t extends X{constructor(t,e={}){super(t);p(this,"id");p(this,"isPressing",!1);p(this,"isDragging",!1);p(this,"isResizing",!1);p(this,"isRotating",!1);p(this,"locking",!1);p(this,"node",null);p(this,"client",N());p(this,"tmpClient",N());p(this,"tmpRect",null);p(this,"options");p(this,"initialX",0);p(this,"initialY",0);p(this,"resizeType");p(this,"resizeIsShift",!1);p(this,"rotateStartVector",{x:0,y:0});p(this,"rotateCenter",{x:0,y:0});p(this,"invokedDragStart",!1);this.id=Dt(),this.client=t,this.options=e}bindNode(t){this.node=t}startDrag(t){const{onStartPress:e}=this.options;if(e&&e(),this.locking)return this.client;this.tmpClient={...this.client};const{x:n,y:s}=t;this.isPressing=!0,this.initialX=n,this.initialY=s,this.invokedDragStart=!1}drag(t){if(this.locking)return this.client;const{onStartDrag:e}=this.options;!this.invokedDragStart&&e&&(this.invokedDragStart=!0,e(this)),this.isDragging=!0;const{x:n,y:s,enabledAngle:o}=t,a=n-this.initialX,c=s-this.initialY,{width:l,height:d,left:h,top:f,angle:g}=this.client,u=this.completeRect({width:l,height:d,left:h+(()=>o===void 0?a:0)(),top:f+c,angle:g});this.setPosition({x:u.left,y:u.top,wait:!0}),this.initialX=n,this.initialY=s;const{onDrag:m}=this.options;if(m){const y=m(u,{x:a,y:c});return this.setPositionButNotUpdateClient({x:y.left,y:y.top}),y}return this.setPosition({x:u.left,y:u.top}),u}endDrag(){const{onEndDrag:t,onEndPress:e}=this.options;this.isPressing=!1,e&&e(),this.initialX=0,this.initialY=0,this.client={...this.values};const n=this.compare(this.client,this.tmpClient);this.tmpRect={...this.client},this.isDragging!==!1&&(this.isDragging=!1,t&&t({diff:n}))}startResize(t){const{onStartPress:e}=this.options;e&&e();const{x:n,y:s,type:o,isShift:a}=t;this.isPressing=!0,this.tmpClient={...this.client},this.initialX=n,this.initialY=s,this.resizeType=o,this.resizeIsShift=a}resize(t){if(!this.isPressing)return this.client;if(this.resizeType===void 0)return this.client;this.isResizing=!0;const{x:e,y:n,isShift:s}=t;this.resizeIsShift=s;const o=e-this.initialX,a=n-this.initialY,c=Math.atan2(a,o),d=Math.sqrt(o*o+a*a),h=0,f=c-W(this.client.angle+h),g=d*Math.cos(f),u=d*Math.sin(f),m=this.resizeIsShift&&!this.options.ratio?this.client.width/this.client.height:this.options.ratio,{position:y,size:x}=Rt(this.resizeType,{width:this.client.width,height:this.client.height,angle:this.client.angle,centerX:this.client.left+this.client.width/2,centerY:this.client.top+this.client.height/2},g,u,m,this.options.minWidth,this.options.minHeight),E={top:y.centerY-x.height/2,left:y.centerX-x.width/2,width:x.width,height:x.height,angle:this.client.angle,index:this.client.index};return this.tmpRect=this.completeRect({...E}),this.values={...this.tmpRect},this.emitValuesChange(),E}endResize(){const{onEndResize:t,onEndPress:e}=this.options;this.isPressing=!1,e&&e(),this.initialX=0,this.initialY=0;const n=this.tmpRect;if(n===null||(this.client=this.completeRect({...n}),this.values={...this.client},this.emitValuesChange(),this.isResizing===!1))return;const s=this.compare(this.client,this.tmpClient);this.tmpClient={...this.client},t&&t({diff:s})}startRotate(t){const{onStartPress:e}=this.options;e&&e();const{x:n,y:s,left:o,top:a,width:c,height:l}=t,d={x:o+c/2,y:a+l/2},h={x:n-d.x,y:s-d.y};this.rotateStartVector=h,this.rotateCenter=d,this.isPressing=!0}rotate(t){if(!this.isPressing)return this.client;this.isRotating=!0;const{x:e,y:n}=t,s=this.rotateCenter,o={x:e-s.x,y:n-s.y},a=It(this.rotateStartVector,o),c=this.client.angle;let l=Math.round(a+c);return l>=360?l-=360:l<0&&(l+=360),l>356||l<4?l=0:l>86&&l<94?l=90:l>176&&l<184?l=180:l>266&&l<274&&(l=270),this.tmpRect=this.completeRect({...this.client,angle:l}),this.values={...this.tmpRect},this.emitValuesChange(),this.tmpRect}endRotate(){const{onEndRotate:t,onEndPress:e}=this.options;if(this.isPressing=!1,e&&e(),this.initialX=0,this.initialY=0,this.tmpRect===null||(this.client=this.completeRect({...this.tmpRect}),this.values={...this.client},this.emitValuesChange(),this.isRotating===!1))return;const n=this.compare(this.client,this.tmpClient);this.tmpClient={...this.client},t&&t({diff:n})}setSize(t){const{width:e,height:n}=t;this.client=this.completeRect({...this.client,width:e,height:n}),this.values={...this.client},this.emitValuesChange()}setPosition(t){const{x:e,y:n,wait:s=!1}=t;this.client=this.completeRect({...this.client,left:e,top:n}),!s&&(this.values={...this.client},this.emitValuesChange())}setPositionButNotUpdateClient(t){this.values={...this.client,left:t.x,top:t.y},this.emitValuesChange()}setAngle(t){this.client=this.completeRect({...this.client,angle:t}),this.values={...this.client},this.emitValuesChange()}setIndex(t){this.client=this.completeRect({...this.client,index:t}),this.values={...this.client},this.emitValuesChange()}completeRect(t){const{left:e=0,top:n=0,width:s=0,height:o=0,angle:a=0,index:c=0}=t;return Object.assign(N(),{...this.client},{left:e,right:e+s,top:n,bottom:n+o,center:{x:e+s/2,y:n+o/2},width:s,height:o,angle:a,index:c})}lock(){this.locking=!0}releaseLock(){this.locking=!1}toJSON(){const{left:t,top:e,width:n,height:s,angle:o}=this.values;return{left:t,top:e,width:n,height:s,angle:o}}compare(t,e){const{left:n,top:s,width:o,height:a,angle:c}=t,{left:l,top:d,width:h,height:f,angle:g}=e;return this.completeRect({left:n-l,top:s-d,width:o-h,height:a-f,angle:c-g})}static toValues(t){const{left:e,top:n,width:s,height:o,angle:a}=t;return{left:e,top:n,width:s,height:o,angle:a}}get[Symbol.toStringTag](){return"TransformRect"}}const Vt={value:"Placeholder",style:{}};class $t extends X{constructor(t){const e={...t,type:w.Text,editing:!1};super(e);p(this,"values",{...Vt});this.values=e}get value(){return this.values.value}setValue(t=""){this.values.value=t,this.emitValuesChange()}toJSON(){const{value:t,url:e,name:n,style:s}=this.values;return{type:w.Text,value:t,url:e,name:n,style:s}}toValues(t){this.values={...t},this.emitValuesChange()}}class Nt extends X{constructor(r){const{url:t}=r,e={url:t};super(e)}get url(){return this.values.url}setUrl(r){this.values.url=r,this.emitValuesChange()}toJSON(){return{type:w.Image,url:this.url}}toValues(r){this.values={...r},this.emitValuesChange()}}class Kt extends X{get stacks(){return this.values.stacks}get index(){return this.values.index}constructor(r={stacks:[],index:-1,canUndo:!1,canRedo:!1}){super(r)}push(r){const{stacks:t,index:e}=this.values;e===t.length-1?this.values.stacks.push(r):this.values.stacks=t.slice(0,e+1).concat(r),this.values.index+=1,this.addSomeStatus(),this.emitValuesChange()}undo(){const{stacks:r,index:t,canUndo:e}=this.values;if(console.log("[DOMAIN]HistoryManage - undo",r,t),!e)return null;const n=r[t];return this.values.index-=1,this.addSomeStatus(),this.emitValuesChange(),n===void 0?null:n}redo(){const{index:r,stacks:t,canRedo:e}=this.values;if(!e)return null;const n=r+1;this.values.index=n;const s=t[n];return console.log("[DOMAIN]HistoryManage - redo",s),this.addSomeStatus(),this.emitValuesChange(),s===void 0?null:s}addSomeStatus(){const{stacks:r,index:t}=this.values;this.values={stacks:r,index:t,canUndo:t>=0,canRedo:t<r.length-1}}}var b=(i=>(i[i.AddThing=0]="AddThing",i[i.DelThing=1]="DelThing",i[i.Drag=2]="Drag",i[i.Resize=3]="Resize",i[i.Rotate=4]="Rotate",i))(b||{});const Xt=dt();class Yt extends X{constructor(t={things:[],background:""}){super(t);p(this,"client",null);p(this,"cursor",{x:0,y:0});p(this,"maxIndex",-1);p(this,"curThingIds",[]);p(this,"selectedThingIds",[]);p(this,"lines",[]);p(this,"isRangeSelecting",!1);p(this,"rangeSelection",null);p(this,"isDraggingRect",!1);p(this,"draggingRect",null);p(this,"isResizingRect",!1);p(this,"isRotatingRect",!1);p(this,"isPressing",!1);p(this,"enableAttach",!0);p(this,"_thingIdJustAdded",null);p(this,"_rangeStartPosition",null);p(this,"_dragStartPos",null);p(this,"history",new Kt);p(this,"elm",null);p(this,"plugins",{});this.history.addListener(e=>{this.emitter.emit("history",e)})}get things(){return this.values.things}saveCardElm(t){this.elm=t}setCanvasClient(t){this.client=t}enableAttachOtherRect(){this.enableAttach=!0}disableAttachOtherRect(){this.enableAttach=!1}onRectStartDrag(){this._dragStartPos={...this.cursor}}getIndex(){return this.maxIndex+=1,this.maxIndex}addThing(t,e){const{type:n,data:s}=t,{client:o={},id:a,skipHistory:c=!1}=e||{};let l=null;if(n===w.Text){const{placeholder:u,name:m="\u5FAE\u8F6F\u96C5\u9ED1",url:y}=s;l=new $t({value:u,name:m,url:y})}if(n===w.Image){const{url:u}=s;l=new Nt({url:u})}if(l===null)return console.warn(`[WARING]unknown type [${n}], please check arguments and try again.`),this;const d=a!==void 0?a:Xt(),h=(o==null?void 0:o.index)!==void 0?o.index:this.getIndex(),f=new _t(N({...o,index:h}),{onStartDrag:()=>{this.draggingRect=f,this.onRectStartDrag(),console.log("[DOMAIN]Canvas - start drag")},onDrag:(u,m)=>{this.isDraggingRect=!0;const[y,x]=this.checkAttachLinesBeforeDrag(u);this.lines=x,this.emitter.emit("updateLines",x);const E=this.findThingsByIds(this.selectedThingIds.filter(P=>P!==d));if(E.length!==0)for(let P=0;P<E.length;P+=1){const _=E[P];_.rect.setPosition({x:_.rect.client.left+m.x,y:_.rect.client.top+m.y})}return x.length!==0&&this.enableAttach?y:u},onEndDrag:u=>{console.log("[DOMAIN]canvas - onEndDrag",u.diff),this.draggingRect=null,this.emitter.emit("updateLines",[]),this.history.push({type:b.Drag,values:JSON.stringify({id:d,diff:u.diff})})},onResize:()=>{this.isResizingRect=!0},onEndResize:u=>{this.isResizingRect=!1,this.history.push({type:b.Resize,values:JSON.stringify({id:d,diff:u.diff})})},onRotate:()=>{this.isRotatingRect=!0},onEndRotate:u=>{this.isRotatingRect=!1,this.history.push({type:b.Rotate,values:JSON.stringify({id:d,diff:u.diff})})},onStartPress:()=>{this.isPressing=!0},onEndPress:()=>{this.isPressing=!1}}),g={id:d,type:n,data:l,rect:f};return this._thingIdJustAdded=g.id,setTimeout(()=>{this._thingIdJustAdded=null},100),this.appendContent(g),c?this:(setTimeout(()=>{this.history.push({type:b.AddThing,values:JSON.stringify(tt(g))})},0),this)}undo(){const t=this.history.undo();if(t===null)return;const{type:e,values:n}=t;if(e===b.AddThing){const{id:s}=JSON.parse(n);this.removeThing(s,{skipHistory:!0})}if(e===b.DelThing){const s=JSON.parse(n);for(let o=0;o<s.length;o+=1){const{id:a,material:c,client:l}=s[o];this.addThing(c,{id:a,client:l,skipHistory:!0})}}if([b.Drag,b.Resize,b.Rotate].includes(e)){const{id:s,diff:o}=JSON.parse(n),a=this.findThingById(s);if(a===null)return;const{rect:{client:c}}=a;if(e===b.Drag){const l={x:c.left-o.left,y:c.top-o.top};this.setPosition(l,s)}if(e===b.Resize){const l={width:c.width-o.width,height:c.height-o.height};this.setSize(l,s)}if(e===b.Rotate){const l=c.angle-o.angle;this.setAngle(l,s)}}}redo(){const t=this.history.redo();if(t===null)return;const{type:e,values:n}=t;if(e===b.AddThing){const{id:s,material:o,client:a}=JSON.parse(n);this.addThing(o,{id:s,client:a,skipHistory:!0})}if(e===b.DelThing){const s=JSON.parse(n);for(let o=0;o<s.length;o+=1){const{id:a}=s[o];this.removeThing(a,{skipHistory:!0})}}if([b.Drag,b.Resize,b.Rotate].includes(e)){const{id:s,diff:o}=JSON.parse(n),a=this.findThingById(s);if(a===null)return;const{rect:{client:c}}=a;if(e===b.Drag){const l={x:c.left+o.left,y:c.top+o.top};this.setPosition(l,s)}if(e===b.Resize){const l={width:c.width+o.width,height:c.height+o.height};console.log("[DOMAIN]Canvas - undo resize",c.width,o.width),this.setSize(l,s)}if(e===b.Rotate){const l=c.angle+o.angle;this.setAngle(l,s)}}}updateContent(t){const{id:e}=t,n=this.values.things.findIndex(s=>s.id===e);n!==-1&&(this.values.things=[...this.values.things.slice(0,n),t,...this.values.things.slice(n+1)],this.emitValuesChange())}appendContent(t){this.values.things=this.values.things.concat(t),this.emitValuesChange()}setSize(t,e){const n=this.findThingById(e);if(n===null)return this;const{id:s,rect:o}=n;return o.setSize(t),this}setPosition(t,e){const n=this.findThingById(e);if(n===null)return this;const{rect:s}=n;return s.setPosition(t),this}setAngle(t,e){const n=this.findThingById(e);if(n===null)return this;const{rect:s}=n;return s.setAngle(t),this}setIndex(t,e){const n=this.findThingById(e);if(n===null)return this;const{rect:s}=n;return s.setIndex(t),this}topSelectedThings(){this.selectedThingIds.length!==0&&this.topThings(this.selectedThingIds)}topThings(t){const e=this.findThingsByIds(t),n=this.things.filter(o=>!t.includes(o.id));let s=0;n.forEach(o=>{s+=1,this.setIndex(s,o.id)}),e.forEach(o=>{s+=1,this.setIndex(s,o.id)}),this.emitValuesChange()}upSelectedThings(t=1){this.selectedThingIds.length!==0&&this.upThings(this.selectedThingIds)}upThings(t,e=1){const n=this.findThingsByIds(t);let s=0,o=0;if(n.length===1){const d=n[0];s=d.rect.client.index,o=d.rect.client.index}else o=Math.max.apply(n.map(d=>d.rect.client.index)),s=Math.min.apply(n.map(d=>d.rect.client.index));const c=this.things.sort((d,h)=>d.rect.client.index-h.rect.client.index).slice(s,o+e+1).filter(d=>!t.includes(d.id));let l=s;c.forEach(d=>{this.setIndex(l,d.id),l+=1}),n.forEach(d=>{this.setIndex(l,d.id),l+=1}),this.emitValuesChange()}groupSelectedContents(t){}ungroupSelectedContents(){}removeThing(t,e={}){const{things:n}=this.values,{wait:s,skipHistory:o}=e;let a=t;typeof t!="number"&&(a=t.id);const c=this.findThingById(a);if(!c)return;const l=n.filter(d=>d.id!==a);this.values.things=l,!s&&(o||this.history.push({type:b.DelThing,values:JSON.stringify(tt(c))}),this.emitValuesChange())}removeSelectedThings(){if(this.selectedThingIds.length===0)return;const t=[...this.selectedThingIds];console.log("[DOMAIN]Canvas - removeSelectedThings"),this.history.push({type:b.DelThing,values:JSON.stringify(t.map(e=>this.findThingById(e)).map(e=>e?tt(e):null).filter(Boolean))}),this.selectedThingIds.forEach(e=>{this.removeThing(e,{wait:!0,skipHistory:!0})}),this.emitValuesChange()}updateBackground(t){}selectThing(t){this.selectedThingIds.length===1&&this.selectedThingIds[0]===t||(this.selectedThingIds=[t],this.emitter.emit("selectContent",this.selectedThingIds))}appendSelectThing(t){this.selectedThingIds.includes(t)||(this.selectedThingIds=this.selectedThingIds.concat(t),this.emitter.emit("selectContent",this.selectedThingIds))}selectThings(t){jt(this.selectedThingIds,t)||(this.selectedThingIds=t,this.emitter.emit("selectContent",this.selectedThingIds))}clearSelectedThings(){console.log("[DOMAIN]Canvas - clearSelectedContent",this.isPressing),!this.isRangeSelecting&&(this.isPressing||this.selectedThingIds.length!==0&&(this.selectedThingIds=[],this.emitter.emit("selectContent",this.selectedThingIds)))}clearAllThings(){this.values.things=[],this.emitValuesChange()}moveThingsByStepInDirection(t,e=1){if(this.selectedThingIds.length===0)return;const n=this.findThingsByIds(this.selectedThingIds);for(let s=0;s<n.length;s+=1){const{rect:o}=n[s],{left:a,top:c}=o.client;t===M.Left&&o.setPosition({x:a-e,y:c}),t===M.Top&&o.setPosition({x:a,y:c-e}),t===M.Right&&o.setPosition({x:a+e,y:c}),t===M.Bottom&&o.setPosition({x:a,y:c+e})}}moveSelectedContentTogether(t,e){}moveThingTo(t={},e){const n=this.findThingById(e);if(n===null)return this;const{x:s,y:o}=t;return n.rect.setPosition({x:s!==void 0?s:n.rect.client.left,y:o!==void 0?o:n.rect.client.top}),this}setCursorPosition(t){this.cursor=t}startRangeSelect(t){console.log("[DOMAIN]Canvas - startRangeSelect",this.isPressing),!this.isPressing&&(this._rangeStartPosition=t)}rangeSelect(t){const{x:e,y:n}=t;if(this._rangeStartPosition===null||this.isPressing)return;if(this.isRangeSelecting===!1&&(this.isRangeSelecting=!0),this.client===null)return console.warn("[DOMAIN]Canvas - rangeSelect \u8BF7\u5148\u8C03\u7528 updateBoundingClientRect \u66F4\u65B0\u753B\u5E03\u5C3A\u5BF8\u3001\u4F4D\u7F6E\u4FE1\u606F"),this;const s=this.client,o={left:s.left,top:s.top},a=this._rangeStartPosition,c=Object.assign(N(),{left:e>a.x?a.x-o.left:e-o.left,top:n>a.y?a.y-o.top:n-o.top,width:Math.abs(e-a.x),height:Math.abs(n-a.y)});this.rangeSelection=c,this.emitter.emit("updateRangeSelection",c);const{things:l}=this.values,d=Lt(c,l);this.selectThings(d.map(h=>h.id))}endRangeSelect(){if(this.isRangeSelecting===!1)return;this.isRangeSelecting=!1;const t=N();this.rangeSelection=t,this.emitter.emit("updateRangeSelection",t)}checkAttachLinesBeforeDrag(t){this.values;const e=[];if(this.client===null)return[t,[]];const{width:n,height:s}=this.client,[o,a]=Ot(t,e.concat([{type:S.Horizontal,origin:0,y:s/2,length:n},{type:S.Vertical,origin:0,x:n/2,length:s}]));return[o,a]}setThingContent(t,e){const n=this.findThingById(e);if(n===null)return this;const{type:s,data:o}=n;return s===w.Text&&o.setValue(t.value),this}getThingId(t){return t!==void 0?t:this._thingIdJustAdded!==null?this._thingIdJustAdded:null}findThingById(t){const e=this.getThingId(t);if(e===null)return null;const n=this.values.things.find(s=>s.id===e);return n===void 0?null:n}findThingsByIds(t){return this.things.filter(e=>!!t.includes(e.id))}registerPlugin(t,e){this.plugins[t]=e}addSelectedListener(t){this.emitter.on("selectContent",e=>{t(e)})}addLinesListener(t){this.emitter.on("updateLines",e=>{t(e)})}addRangeSelectionListener(t){this.emitter.on("updateRangeSelection",e=>{t(e)})}addHistoryListener(t){this.emitter.on("history",e=>{t(e)})}toJSON(){const{background:t,things:e}=this.values;return JSON.stringify({background:t,contents:e.map(n=>{const{id:s,type:o,data:a,rect:c}=n;return{id:s,type:o,data:a.toJSON(),rect:c.toJSON()}})})}emitValuesChange(){if(this.values!==void 0)for(let t=0;t<this.listeners.length;t+=1){const e=this.listeners[t];e({...this.values})}}get[Symbol.toStringTag](){return"Canvas"}}function tt(i){const{id:r,type:t,data:e,rect:n}=i;return{id:r,material:(()=>{if(t===w.Text)return{type:w.Text,data:{placeholder:e.values.value,name:e.values.name,url:e.values.url}};if(t===w.Image)return{type:w.Image,data:{url:e.values.url}}})(),client:n.client}}function jt(i,r){if(i.length!==r.length)return!1;const t=i.sort(),e=r.sort();let n=0;for(let s=0;s<i.length;s+=1){const o=t[s],a=e[s];o===a&&(n+=1)}return n===i.length}function F(i,r,t=document,e){const n=(...s)=>{r(...s),e&&t.removeEventListener(i,n)};return t.addEventListener(i,n),()=>{t.removeEventListener(i,n)}}function Jt(i,r={}){const{width:t,height:e}=i,{maxWidth:n,maxHeight:s}=r;return n!==void 0?{width:n,height:e/t*n}:s!==void 0?{width:t/e*s,height:s}:{width:t,height:e}}var et=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function it(i,r,t,e){i.addEventListener?i.addEventListener(r,t,e):i.attachEvent&&i.attachEvent("on".concat(r),function(){t(window.event)})}function ut(i,r){for(var t=r.slice(0,r.length-1),e=0;e<t.length;e++)t[e]=i[t[e].toLowerCase()];return t}function ft(i){typeof i!="string"&&(i=""),i=i.replace(/\s/g,"");for(var r=i.split(","),t=r.lastIndexOf("");t>=0;)r[t-1]+=",",r.splice(t,1),t=r.lastIndexOf("");return r}function Ft(i,r){for(var t=i.length>=r.length?i:r,e=i.length>=r.length?r:i,n=!0,s=0;s<t.length;s++)e.indexOf(t[s])===-1&&(n=!1);return n}for(var Y={backspace:8,"\u232B":8,tab:9,clear:12,enter:13,"\u21A9":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"\u21EA":20,",":188,".":190,"/":191,"`":192,"-":et?173:189,"=":et?61:187,";":et?59:186,"'":222,"[":219,"]":221,"\\":220},O={"\u21E7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,cmd:91,command:91},nt={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},k={16:!1,18:!1,17:!1,91:!1},R={},U=1;U<20;U++)Y["f".concat(U)]=111+U;var v=[],gt=!1,pt="all",mt=[],H=function(r){return Y[r.toLowerCase()]||O[r.toLowerCase()]||r.toUpperCase().charCodeAt(0)},Ut=function(r){return Object.keys(Y).find(function(t){return Y[t]===r})},Ht=function(r){return Object.keys(O).find(function(t){return O[t]===r})};function yt(i){pt=i||"all"}function j(){return pt||"all"}function qt(){return v.slice(0)}function Gt(){return v.map(function(i){return Ut(i)||Ht(i)||String.fromCharCode(i)})}function Zt(i){var r=i.target||i.srcElement,t=r.tagName,e=!0;return(r.isContentEditable||(t==="INPUT"||t==="TEXTAREA"||t==="SELECT")&&!r.readOnly)&&(e=!1),e}function Qt(i){return typeof i=="string"&&(i=H(i)),v.indexOf(i)!==-1}function Wt(i,r){var t,e;i||(i=j());for(var n in R)if(Object.prototype.hasOwnProperty.call(R,n))for(t=R[n],e=0;e<t.length;)t[e].scope===i?t.splice(e,1):e++;j()===i&&yt(r||"all")}function te(i){var r=i.keyCode||i.which||i.charCode,t=v.indexOf(r);if(t>=0&&v.splice(t,1),i.key&&i.key.toLowerCase()==="meta"&&v.splice(0,v.length),(r===93||r===224)&&(r=91),r in k){k[r]=!1;for(var e in O)O[e]===r&&(L[e]=!1)}}function ee(i){if(typeof i>"u")Object.keys(R).forEach(function(o){return delete R[o]});else if(Array.isArray(i))i.forEach(function(o){o.key&&st(o)});else if(typeof i=="object")i.key&&st(i);else if(typeof i=="string"){for(var r=arguments.length,t=new Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];var n=t[0],s=t[1];typeof n=="function"&&(s=n,n=""),st({key:i,scope:n,method:s,splitKey:"+"})}}var st=function(r){var t=r.key,e=r.scope,n=r.method,s=r.splitKey,o=s===void 0?"+":s,a=ft(t);a.forEach(function(c){var l=c.split(o),d=l.length,h=l[d-1],f=h==="*"?"*":H(h);if(!!R[f]){e||(e=j());var g=d>1?ut(O,l):[];R[f]=R[f].filter(function(u){var m=n?u.method===n:!0;return!(m&&u.scope===e&&Ft(u.mods,g))})}})};function vt(i,r,t,e){if(r.element===e){var n;if(r.scope===t||r.scope==="all"){n=r.mods.length>0;for(var s in k)Object.prototype.hasOwnProperty.call(k,s)&&(!k[s]&&r.mods.indexOf(+s)>-1||k[s]&&r.mods.indexOf(+s)===-1)&&(n=!1);(r.mods.length===0&&!k[16]&&!k[18]&&!k[17]&&!k[91]||n||r.shortcut==="*")&&r.method(i,r)===!1&&(i.preventDefault?i.preventDefault():i.returnValue=!1,i.stopPropagation&&i.stopPropagation(),i.cancelBubble&&(i.cancelBubble=!0))}}}function xt(i,r){var t=R["*"],e=i.keyCode||i.which||i.charCode;if(!!L.filter.call(this,i)){if((e===93||e===224)&&(e=91),v.indexOf(e)===-1&&e!==229&&v.push(e),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(u){var m=nt[u];i[u]&&v.indexOf(m)===-1?v.push(m):!i[u]&&v.indexOf(m)>-1?v.splice(v.indexOf(m),1):u==="metaKey"&&i[u]&&v.length===3&&(i.ctrlKey||i.shiftKey||i.altKey||(v=v.slice(v.indexOf(m))))}),e in k){k[e]=!0;for(var n in O)O[n]===e&&(L[n]=!0);if(!t)return}for(var s in k)Object.prototype.hasOwnProperty.call(k,s)&&(k[s]=i[nt[s]]);i.getModifierState&&!(i.altKey&&!i.ctrlKey)&&i.getModifierState("AltGraph")&&(v.indexOf(17)===-1&&v.push(17),v.indexOf(18)===-1&&v.push(18),k[17]=!0,k[18]=!0);var o=j();if(t)for(var a=0;a<t.length;a++)t[a].scope===o&&(i.type==="keydown"&&t[a].keydown||i.type==="keyup"&&t[a].keyup)&&vt(i,t[a],o,r);if(e in R){for(var c=0;c<R[e].length;c++)if((i.type==="keydown"&&R[e][c].keydown||i.type==="keyup"&&R[e][c].keyup)&&R[e][c].key){for(var l=R[e][c],d=l.splitKey,h=l.key.split(d),f=[],g=0;g<h.length;g++)f.push(H(h[g]));f.sort().join("")===v.sort().join("")&&vt(i,l,o,r)}}}}function ie(i){return mt.indexOf(i)>-1}function L(i,r,t){v=[];var e=ft(i),n=[],s="all",o=document,a=0,c=!1,l=!0,d="+",h=!1;for(t===void 0&&typeof r=="function"&&(t=r),Object.prototype.toString.call(r)==="[object Object]"&&(r.scope&&(s=r.scope),r.element&&(o=r.element),r.keyup&&(c=r.keyup),r.keydown!==void 0&&(l=r.keydown),r.capture!==void 0&&(h=r.capture),typeof r.splitKey=="string"&&(d=r.splitKey)),typeof r=="string"&&(s=r);a<e.length;a++)i=e[a].split(d),n=[],i.length>1&&(n=ut(O,i)),i=i[i.length-1],i=i==="*"?"*":H(i),i in R||(R[i]=[]),R[i].push({keyup:c,keydown:l,scope:s,mods:n,shortcut:e[a],method:t,key:e[a],splitKey:d,element:o});typeof o<"u"&&!ie(o)&&window&&(mt.push(o),it(o,"keydown",function(f){xt(f,o)},h),gt||(gt=!0,it(window,"focus",function(){v=[]},h)),it(o,"keyup",function(f){xt(f,o),te(f)},h))}function ne(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(R).forEach(function(t){var e=R[t].filter(function(n){return n.scope===r&&n.shortcut===i});e.forEach(function(n){n&&n.method&&n.method()})})}var rt={getPressedKeyString:Gt,setScope:yt,getScope:j,deleteScope:Wt,getPressedKeyCodes:qt,isPressed:Qt,filter:Zt,trigger:ne,unbind:ee,keyMap:Y,modifier:O,modifierMap:nt};for(var ot in rt)Object.prototype.hasOwnProperty.call(rt,ot)&&(L[ot]=rt[ot]);if(typeof window<"u"){var se=window.hotkeys;L.noConflict=function(i){return i&&window.hotkeys===L&&(window.hotkeys=se),L},window.hotkeys=L}let q=null;function re(i){if(q)return q;const r=e=>{},t=()=>{};return document.addEventListener("keydown",r),document.addEventListener("keyup",t),L("left",()=>{i.moveThingsByStepInDirection(M.Left,5)}),L("up",()=>{i.moveThingsByStepInDirection(M.Top,5)}),L("down",()=>{i.moveThingsByStepInDirection(M.Bottom,5)}),L("right",()=>{i.moveThingsByStepInDirection(M.Right,5)}),L("backspace",(e,n)=>{e.preventDefault(),console.log("[UTILS]hotkeys - press backspace"),i.removeSelectedThings()}),L("ctrl+up, command+up",(e,n)=>{e.preventDefault(),i.upSelectedThings()}),q=()=>{document.removeEventListener("keydown",r),document.removeEventListener("keyup",t)},q}const K=[],wt={n:"n",s:"s",e:"e",w:"w",ne:"tr",nw:"tl",se:"br",sw:"bl"};function oe(){const i=document.getElementById("btn-add-text"),r=document.getElementById("btn-history-undo"),t=document.getElementById("btn-history-redo"),e=document.getElementById("input-image"),n=document.getElementById("canvas");if(!n)return;const s=new Yt;s.setCanvasClient(n.getBoundingClientRect()),re(s),s.addListener(c=>{const{things:l}=c,d=l.map(g=>g.id),h=d.map(g=>({[g]:!0})).reduce((g,u)=>({...g,...u}),[]);console.log("[PAGE]run - new values things",l);for(let g=0;g<K.length;g+=1){const{id:u,thing:m,$node:y}=K[g];delete h[u],!d.includes(u)&&(d.includes(u)||(K.splice(g,1),n.removeChild(y)))}const f=Object.keys(h).map(Number);console.log("[PAGE]run - created ids",f);for(let g=0;g<f.length;g+=1){const u=f[g],m=l.find(C=>C.id===u);if(!m)continue;const{id:y,type:x,data:E,rect:P}=m,{client:{width:_,height:G,left:Z,top:J}}=P,A=document.createElement("div");A.id=`node-${y}`,A.className="rect",s.selectedThingIds.includes(y)&&o(y,m,A),A.style.cssText=`width: ${_}px; height: ${G}px; left: ${Z}px; top: ${J}px`,console.log("[PAGE]run - add new thing"),P.addListener(C=>{A.style.left=`${C.left}px`,A.style.top=`${C.top}px`,A.style.width=`${C.width}px`,A.style.height=`${C.height}px`,A.style.zIndex=String(C.index)}),A.addEventListener("mousedown",C=>{C.stopPropagation();let ct=!0,{clientX:ce,clientY:ae}=C;P.startDrag({x:ce,y:ae});const bt=Tt=>{if(!ct)return;Tt.stopImmediatePropagation();const{clientX:he,clientY:de}=Tt;P.drag({x:he,y:de})},St=()=>{document.removeEventListener("mousemove",bt),document.removeEventListener("mouseup",St),ct&&(ct=!1,P.endDrag())};document.addEventListener("mousemove",bt),document.addEventListener("mouseup",St);const at=s.findThingById(y);console.log(at),!(at&&at.rect.locking)&&(s.selectedThingIds.length>1||s.selectThing(y))});const Q=(()=>{if(x===w.Text){const C=document.createElement("div");return C.className="text",C.innerText=E.values.value,C}if(x===w.Image){const C=document.createElement("img");return C.className="canvas__image",C.src=E.values.url,C}return null})();Q&&A.appendChild(Q),K.push({id:y,thing:m,$node:A}),n.appendChild(A)}});function o(c,l,d){d.className="rect bordered","n,s,e,w,ne,nw,se,sw".split(",").forEach(h=>{const f=document.createElement("div"),g=`node-${c}-square-${h}`;if(document.getElementById(g))return;f.id=g;const m=`${At(0,h)}-resize`;f.style.cursor=m,f.className=`${wt[h]} resizable-handler square`,d.appendChild(f);let y=!1;f.addEventListener("mousedown",x=>{if(x.button!==0)return;document.body.style.cursor=m;const{clientX:E,clientY:P}=x,_=wt[h];l.rect.startResize({x:E,y:P,type:_,isShift:x.shiftKey}),y=!0;const G=J=>{if(!y)return;J.stopImmediatePropagation();const{clientX:A,clientY:Q}=J,C=J.shiftKey;l.rect.resize({x:A,y:Q,isShift:C})};document.addEventListener("mousemove",G);const Z=()=>{document.body.style.cursor="auto",document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",Z),y&&(y=!1,l.rect.endResize())};document.addEventListener("mouseup",Z)})})}function a(c,l,d){d.className="rect","n,s,e,w,ne,nw,se,sw".split(",").forEach(h=>{const f=`node-${c}-square-${h}`,g=document.getElementById(f);g&&d.removeChild(g)})}s.addSelectedListener(c=>{for(let l=0;l<K.length;l+=1){const{id:d,thing:h,$node:f}=K[l];if(!c.includes(d)){a(d,h,f);continue}o(d,h,f)}}),s.addRangeSelectionListener(c=>{const l=document.getElementById("range");if(!l)return;const{width:d,height:h,left:f,top:g}=c;l.style.cssText=`width: ${d}px; height: ${h}px; left: ${f}px; top: ${g}px`}),s.addLinesListener(c=>{const l=document.getElementById("horizontal");l&&n.removeChild(l);const d=document.getElementById("vertical");d&&n.removeChild(d);const h=[];for(let f=0;f<c.length;f+=1){const g=c[f],{type:u,length:m,origin:y}=g;if(u===S.Horizontal){const x=document.createElement("div");document.getElementById("horizontal")||(x.id="horizontal",x.style.cssText=`position: absolute; z-index: 101; background-color: #ff00cc; top: ${g.y}px; left: ${y}px; width: ${m}px; height: 1px;`,h.push(x))}if(u===S.Vertical){const x=document.createElement("div");document.getElementById("vertical")||(x.id="vertical",x.style.cssText=`position: absolute; z-index: 101; background-color: #ff00cc; left: ${g.x}px; top: ${y}px; height: ${m}px; width: 1px;`,h.push(x))}}for(let f=0;f<h.length;f+=1)n.appendChild(h[f])}),F("mousemove",({clientX:c,clientY:l})=>{s.setCursorPosition({x:c,y:l})},n),F("mousedown",({clientX:c,clientY:l})=>{let d=!0,h=!1,f={clientX:c,clientY:l};const u=F("mousemove",y=>{const{clientX:x,clientY:E}=y;d!==!1&&(h||(s.startRangeSelect({x:f.clientX,y:f.clientY}),h=!0),s.rangeSelect({x,y:E}))});F("mouseup",()=>{d=!1,h=!1,console.log("end select"),s.endRangeSelect(),u()},document,!0)},n),n.addEventListener("mouseup",()=>{s.clearSelectedThings()}),i&&i.addEventListener("click",()=>{s.addThing({type:w.Text,data:{placeholder:"\u8BF7\u7F16\u8F91\u6587\u672C"}},{client:{left:120,top:120,width:120,height:24}})}),e&&e.addEventListener("change",c=>{var f;if(((f=c==null?void 0:c.target)==null?void 0:f.files)===null)return;const l=c.target.files[0],d=URL.createObjectURL(l),h=document.createElement("img");h.src=d,h.onload=()=>{const{naturalHeight:g,naturalWidth:u}=h;s.addThing({type:w.Image,data:{url:d}},{client:{left:120,top:120,...Jt({width:u,height:g},{maxWidth:360})}})}}),r&&r.addEventListener("click",()=>{s.undo()}),t&&t.addEventListener("click",()=>{s.redo()})}const ge="",le=()=>{const i=document.querySelector("#root");if(i!==null)return i.innerHTML=`
<div class="page">
  <div class="page__content">
    <div class="tools flex">
      <div class="flex left">
        <img class="logo--vanilla" src="https://plainjs.com/apple-touch-icon-60x60.png" alt="vanilla" />
        <div class="btns history">
          <div id="btn-history-undo" class="btn btn--icon">
            <svg width="24" height="24" viewBox="0 0 32 32"><path fill="currentColor" d="M20 10H7.815l3.587-3.586L10 5l-6 6l6 6l1.402-1.415L7.818 12H20a6 6 0 0 1 0 12h-8v2h8a8 8 0 0 0 0-16Z"/></svg>
          </div>
          <div id="btn-history-redo" class="btn btn--icon">
            <svg width="24" height="24" viewBox="0 0 32 32"><path fill="currentColor" d="M12 10h12.185l-3.587-3.586L22 5l6 6l-6 6l-1.402-1.415L24.182 12H12a6 6 0 0 0 0 12h8v2h-8a8 8 0 0 1 0-16Z"/></svg>
          </div>
        </div>
      </div>
      <div class="btns">
        <div id="btn-add-text" class="btn btn--icon">
          <svg width="24" height="24" viewBox="0 0 32 32"><path fill="currentColor" d="M25 12h-5v2h5a1 1 0 0 1 1 1v2h-4a3.003 3.003 0 0 0-3 3v1a3.003 3.003 0 0 0 3 3h6v-9a3.003 3.003 0 0 0-3-3zm-3 10a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h4v3zm-6 2h2L12 7h-2L4 24h2l1.694-5h6.613zm-7.629-7l2.497-7.371h.266L13.63 17z"/></svg>
        </div>
        <div id="btn-add-image" class="btn btn--icon">
          <svg width="24" height="24" viewBox="0 0 32 32"><path fill="currentColor" d="M19 14a3 3 0 1 0-3-3a3 3 0 0 0 3 3Zm0-4a1 1 0 1 1-1 1a1 1 0 0 1 1-1Z"/><path fill="currentColor" d="M26 4H6a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h20a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm0 22H6v-6l5-5l5.59 5.59a2 2 0 0 0 2.82 0L21 19l5 5Zm0-4.83l-3.59-3.59a2 2 0 0 0-2.82 0L18 19.17l-5.59-5.59a2 2 0 0 0-2.82 0L6 17.17V6h20Z"/></svg>
          <input id="input-image" class="btn__input" type="file" accept=".png,.jpg,.jpeg" />
        </div>
      </div>
      <div class="btns"></div>
    </div>
    <div id="canvas" class="canvas">
      <div id="range" class="canvas__range-selection"></div>
    </div>
  </div>
</div>
`,oe(),Promise.resolve()},lt="vanilla";(i=>{if(i[lt]={bootstrap:()=>Promise.resolve(),mount:()=>le(),unmount:()=>Promise.resolve()},i.__RICH__){i[lt].mount();return}i[lt].mount()})(window)})();
